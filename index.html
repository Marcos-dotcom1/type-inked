<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="google" content="notranslate" />
    <title>Type Inked</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Bangers&family=Carter+One&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --cream: #fff5d1;
        --sepia: #704214;
        --red: #d72a2a;
        --green: #3c8242;
        --yellow: #ffd700;
      }
      /* â€”â€”â€”â€”â€” Base Body & Texture â€”â€”â€”â€”â€” */
      body {
        background: repeating-linear-gradient(
          45deg,
          #f0e6d3,
          #f0e6d3 2px,
          #e8ddc9 2px,
          #e8ddc9 4px
        );
        font-family: "Carter One", cursive;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        color: var(--sepia);
        overflow: hidden;
        position: relative;
      }
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        background: url("data:image/png;base64,iVBORw0Kâ€¦") no-repeat;
        background-size: cover;
        opacity: 0.15;
        pointer-events: none;
      }

      /* â€”â€”â€”â€”â€” Your Main Container â€”â€”â€”â€”â€” */
      .container {
        max-width: 800px;
        width: 90%;
        text-align: center;
        position: relative;
        z-index: 1; /* above texture */
      }
      .btn {
        background: var(--red);
        color: var(--cream);
        padding: 15px 30px;
        border: 3px solid var(--sepia);
        border-radius: 30px;
        cursor: pointer;
        font-size: 20px;
        margin: 15px;
        font-family: "Bangers", cursive;
        letter-spacing: 2px;
        text-shadow: 2px 2px 0 var(--sepia);
        box-shadow: 5px 5px 0 var(--sepia);
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .btn:hover {
        transform: translate(2px, 2px);
        box-shadow: 3px 3px 0 var(--sepia);
      }
      .hidden {
        display: none !important;
      }

      /* â€”â€”â€”â€”â€” Stats & Text Container â€”â€”â€”â€”â€” */
      #stats {
        font-size: 24px;
        margin: 30px 0;
        background: var(--cream);
        padding: 20px;
        border-radius: 15px;
        border: 3px solid var(--sepia);
        box-shadow: 5px 5px 0 var(--sepia);
      }
      #textContainer {
        font-size: 32px;
        line-height: 1.5;
        margin: 40px 0;
        padding: 30px;
        background: var(--cream);
        border-radius: 15px;
        border: 3px solid var(--sepia);
        box-shadow: 5px 5px 0 var(--sepia);
        user-select: none;
      }
      .letter {
        position: relative;
        padding: 0 2px;
        transition: all 0.1s;
      }
      .correct {
        color: var(--green);
        animation: bounce 0.3s ease;
      }
      .incorrect {
        color: var(--red);
        animation: shake 0.5s;
        border-bottom: 3px solid var(--red);
      }
      .current {
        background: var(--yellow);
        border-radius: 5px;
        animation: pulse 1s infinite;
      }

      /* â€”â€”â€”â€”â€” Countdown & Completion Overlay â€”â€”â€”â€”â€” */
      #countdown {
        font-size: 72px;
        font-weight: bold;
        color: var(--red);
        margin: 40px 0;
        text-shadow: 3px 3px 0 var(--sepia);
        font-family: "Bangers", cursive;
      }
      #completionScreen {
        background: var(--cream);
        padding: 40px;
        border-radius: 20px;
        border: 3px solid var(--sepia);
        box-shadow: 10px 10px 0 var(--sepia);
        position: fixed;
        inset: 50% auto auto 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
      }
      #pauseOverlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 245, 209, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 72px;
        color: var(--red);
        font-family: "Bangers", cursive;
        text-shadow: 5px 5px 0 var(--sepia);
        z-index: 999;
      }

      /* â€”â€”â€”â€”â€” Animations â€”â€”â€”â€”â€” */
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        50% {
          transform: translateX(5px);
        }
        75% {
          transform: translateX(-5px);
        }
      }
      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      /* â€”â€”â€”â€”â€” COMIC TEXT OVERLAY â€”â€”â€”â€”â€” */
      #animation-overlay {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 2; /* above your .container */
      }
      .comic-text {
        position: absolute;
        font-family: "Bangers", cursive;
        font-size: 3rem;
        text-shadow: 2px 2px #000;
        animation: popAndFade 1.5s ease forwards;
        user-select: none;
      }
      @keyframes popAndFade {
        0% {
          opacity: 0;
          transform: scale(0.5) rotate(0deg);
        }
        30% {
          opacity: 1;
          transform: scale(1.3) rotate(-10deg);
        }
        60% {
          transform: scale(0.9) rotate(10deg);
        }
        100% {
          opacity: 0;
          transform: scale(0) rotate(0);
        }
      }
    </style>
  </head>
  <body>
    <!-- ðŸŽ‰ COMIC TEXTS WILL BE APPENDED HERE -->
    <div id="animation-overlay"></div>

    <!-- your existing UI -->
    <div class="container">
      <button id="startBtn" class="btn">Start Test [Enter]</button>
      <button id="pauseBtn" class="btn hidden">Pause [ESC]</button>
      <div id="countdown" class="hidden"></div>
      <div id="stats" class="hidden">
        <div>WPM: <span id="wpm">0</span></div>
        <div>Accuracy: <span id="accuracy">100</span>%</div>
        <div>Time: <span id="time">0</span>s</div>
      </div>
      <div id="textContainer" class="hidden"></div>
      <div id="completionScreen" class="hidden">
        <h2>Test Complete!</h2>
        <div class="final-stats">
          <p>Final WPM: <span id="finalWpm">0</span></p>
          <p>Accuracy: <span id="finalAccuracy">0</span>%</p>
          <p>Time: <span id="finalTime">0</span>s</p>
        </div>
        <button id="restartBtn" class="btn">Try Again [Enter]</button>
      </div>
      <div id="pauseOverlay" class="hidden">PAUSED</div>
    </div>

    <script>
      // â€”â€”â€”â€”â€” GAME LOGIC (unchanged) â€”â€”â€”â€”â€”

      let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      let visualViewport = window.visualViewport;

      if (isMobile && visualViewport) {
        visualViewport.addEventListener("resize", () => {
          const container = document.querySelector(".container");
          if (visualViewport.height < window.innerHeight * 0.7) {
            container.classList.add("keyboard-open");
          } else {
            container.classList.remove("keyboard-open");
          }
        });
      }
      document.addEventListener(
        "touchmove",
        (e) => {
          if (e.scale !== 1) e.preventDefault();
        },
        { passive: false }
      );

      const texts = [
        "Swell bananas, jazz cats! Let's twist again like we did last summer!",
        "Hot diggity dog! The Charleston is the bee's knees, daddy-o!",
        "Twenty-three skidoo! Flappers and fellas, let's paint the town red!",
        "Putting on the Ritz! Those darb sheiks really know how to toddle!",
        "No soap radio! Let's beat our gums over some giggle water, see?",
      ];

      let currentText = "";
      let currentIndex = 0;
      let startTime, pauseTime, timerInterval;
      let isPaused = false;
      let isTestActive = false;
      let totalTyped = 0;
      let correctTyped = 0;

      const elements = {
        startBtn: document.getElementById("startBtn"),
        pauseBtn: document.getElementById("pauseBtn"),
        stats: document.getElementById("stats"),
        textContainer: document.getElementById("textContainer"),
        countdown: document.getElementById("countdown"),
        completionScreen: document.getElementById("completionScreen"),
        pauseOverlay: document.getElementById("pauseOverlay"),
        wpm: document.getElementById("wpm"),
        accuracy: document.getElementById("accuracy"),
        time: document.getElementById("time"),
        finalWpm: document.getElementById("finalWpm"),
        finalAccuracy: document.getElementById("finalAccuracy"),
        finalTime: document.getElementById("finalTime"),
        restartBtn: document.getElementById("restartBtn"),
      };

      function initTest() {
        currentText = texts[Math.floor(Math.random() * texts.length)];
        currentIndex = 0;
        totalTyped = 0;
        correctTyped = 0;
        elements.textContainer.innerHTML = "";

        currentText.split("").forEach((char) => {
          const span = document.createElement("span");
          span.textContent = char;
          span.classList.add("letter");
          elements.textContainer.appendChild(span);
        });
      }

      function startCountdown() {
        let count = 3;
        elements.countdown.textContent = count;
        elements.countdown.classList.remove("hidden");

        const countdownInterval = setInterval(() => {
          count--;
          elements.countdown.textContent = count || "GO!";

          if (count <= 0) {
            clearInterval(countdownInterval);
            elements.countdown.classList.add("hidden");
            startTest();
          }
        }, 1000);
      }

      function startTest() {
        isTestActive = true;
        elements.stats.classList.remove("hidden");
        elements.textContainer.classList.remove("hidden");
        elements.pauseBtn.classList.remove("hidden");
        startTime = Date.now();
        startTimer();
        updateCurrentLetter();
      }

      function startTimer() {
        timerInterval = setInterval(() => {
          const elapsed = Math.floor((Date.now() - startTime) / 1000);
          elements.time.textContent = elapsed;

          const minutes = elapsed / 60;
          const wpm = Math.round(correctTyped / 5 / minutes) || 0;
          elements.wpm.textContent = wpm;

          const accuracy =
            totalTyped > 0
              ? Math.round((correctTyped / totalTyped) * 100)
              : 100;
          elements.accuracy.textContent = accuracy;
        }, 1000);
      }

      function handleTyping(e) {
        if (!isTestActive || isPaused) return;
        if (["Shift", "Control", "Alt", "Meta", "CapsLock"].includes(e.key))
          return;

        const currentLetter = elements.textContainer.children[currentIndex];

        if (e.key === "Backspace") {
          if (currentIndex > 0) {
            const prevLetter =
              elements.textContainer.children[currentIndex - 1];
            prevLetter.classList.remove("correct", "incorrect");
            currentIndex--;
            if (prevLetter.classList.contains("correct")) correctTyped--;
            totalTyped = Math.max(totalTyped - 1, 0);
            updateCurrentLetter();
          }
          return;
        }

        if (e.key.length === 1) {
          totalTyped++;

          if (e.key === currentLetter.textContent) {
            currentLetter.classList.add("correct");
            correctTyped++;
            currentLetter.classList.remove("incorrect");
            currentIndex++;
            updateCurrentLetter();
          } else {
            currentLetter.classList.add("incorrect");
            currentLetter.style.animation = "shake 0.5s";
          }

          if (currentIndex >= currentText.length) {
            finishTest();
          }
        }
      }

      function updateCurrentLetter() {
        elements.textContainer
          .querySelectorAll(".current")
          .forEach((el) => el.classList.remove("current"));
        if (currentIndex < elements.textContainer.children.length) {
          elements.textContainer.children[currentIndex].classList.add(
            "current"
          );
        }
      }

      function finishTest() {
        clearInterval(timerInterval);
        isTestActive = false;
        elements.stats.classList.add("hidden");
        elements.textContainer.classList.add("hidden");
        elements.pauseBtn.classList.add("hidden");

        elements.finalWpm.textContent = elements.wpm.textContent;
        elements.finalAccuracy.textContent = elements.accuracy.textContent;
        elements.finalTime.textContent = elements.time.textContent;
        elements.completionScreen.classList.remove("hidden");
      }

      function togglePause() {
        if (!isTestActive) return;

        isPaused = !isPaused;
        elements.pauseOverlay.classList.toggle("hidden", !isPaused);
        elements.pauseBtn.textContent = isPaused
          ? "Resume [ESC]"
          : "Pause [ESC]";

        if (isPaused) {
          pauseTime = Date.now();
          clearInterval(timerInterval);
        } else {
          startTime += Date.now() - pauseTime;
          startTimer();
        }
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && isTestActive) togglePause();
        else if (e.key === "Enter" && !isTestActive) startCountdown();
        else if (isTestActive && !isPaused) handleTyping(e);
      });

      elements.startBtn.addEventListener("click", () => {
        elements.startBtn.classList.add("hidden");
        initTest();
        startCountdown();
      });

      elements.restartBtn.addEventListener("click", () => {
        elements.completionScreen.classList.add("hidden");
        elements.startBtn.classList.remove("hidden");
        initTest();
      });

      initTest();

      // â€”â€”â€”â€”â€” COMIC POP-IN OVERLAY â€”â€”â€”â€”â€”
      const overlay = document.getElementById("animation-overlay");
      const comicTexts = ["BANG!", "POW!", "WHAM!", "ZAP!", "BOOM!"];

      function spawnComic() {
        const el = document.createElement("div");
        el.className = "comic-text";
        el.textContent =
          comicTexts[Math.floor(Math.random() * comicTexts.length)];
        // random on-screen position
        el.style.left = Math.random() * (window.innerWidth - 200) + "px";
        el.style.top = Math.random() * (window.innerHeight - 100) + "px";
        // random theme color
        el.style.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
        overlay.appendChild(el);
        setTimeout(() => overlay.removeChild(el), 1500);
      }

      // spawn every 400â€“800ms
      setInterval(spawnComic, Math.random() * 400 + 400);
    </script>
  </body>
</html>
